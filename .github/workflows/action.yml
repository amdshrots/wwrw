name: macOS Remote Desktop

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  setup-remote-desktop:
    runs-on: [macOS-latest]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Homebrew
        run: |
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> $HOME/.zprofile
          eval "$(/opt/homebrew/bin/brew shellenv)"

      # Remove or replace xrdb if not essential
      - name: Install essential tools
        run: |
          brew install xrdb || echo "xrdb installation skipped"
          # Remove the service command for `xrdb` as it is not supported
          # sudo brew services start xrdb

      - name: Allow Remote Login
        run: |
          sudo systemsetup -setremotelogin on

      - name: Print IP Address
        run: |
          echo "IP Address: $(curl -s ifconfig.me)"
          echo "Use Remote Desktop to connect to this IP address with the username 'runner' and the password 'github'."
