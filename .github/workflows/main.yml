name: macOS VNC Server

on:
  workflow_dispatch:

jobs:
  playit-vnc:
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install dependencies
        run: brew install tightvnc

      - name: Start VNC server
        run: |
          /usr/local/bin/tightvncserver :1 -geometry 1024x768 -depth 24

      - name: Get IP Address
        run: |
          echo "IP_ADDRESS=$(ipconfig getifaddr en0)" >> $GITHUB_ENV

      - name: Start Pinggy Tunnel
        uses: pinggy-io/pinggy-action@v1
        id: pinggy
        with:
          token: ${{ secrets.PINGGY_TOKEN }}
          target: ${{ env.IP_ADDRESS }}:5901

      - name: Print VNC connection details
        run: | 
          echo "Server: ${{ steps.pinggy.outputs.tunnel_url }}"
          echo "Password: kaiden"
          
      

